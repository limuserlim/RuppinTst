import streamlit as st
import google.generativeai as genai
import quest  # ×”×§×•×‘×¥ ×”×©× ×™
from google.api_core import exceptions

# --- ×”×’×“×¨×ª ×”×¢××•×“ ---
st.set_page_config(page_title="××¢×¨×›×ª × ×™×”×•×œ ×¨×•×¤×™×Ÿ", page_icon="ğŸ“", layout="centered")

# --- ×”×’×“×¨×ª ×”××•×— ×©×œ LOOZ ---
LOOZ_INSTRUCTIONS = """
1.    ××œ×’×•

×›×œ×œ×™

×ª×¤×§×™×“: ××ª×” ××•××—×” Python ×‘×›×™×¨ ×•××•××—×” ××œ×’×•×¨×™×ª××™×§×” ×”××ª××—×” ×‘×‘×¢×™×•×ª ××•×¤×˜×™××™×–×¦×™×” (CSP). 

××©×™××”: ×›×ª×•×‘ ×¡×§×¨×™×¤×˜ Python ××œ× ×œ×‘× ×™×™×ª ××¢×¨×›×ª ×©×¢×•×ª ×œ×‘×™×ª ×¡×¤×¨, ×”××‘×•×¡×¡ ×¢×œ

×§×‘×¦×™ ×§×œ×˜ (Excel),  ×ª×•×š ×¢××™×“×” ×‘××™×œ×•×¦×™× ×§×©×™×—×™× ×•×˜×™×¤×•×œ ×‘× ×ª×•× ×™×

"××œ×•×›×œ×›×™×".



×”×¡×§×¨×™×¤×˜ × ××¦× ×‘×”××©×š ×•×™×© ×œ×”×¨×™×¥ ××•×ª×• ×¢×œ × ×ª×•× ×™ ×”×§×œ×˜ ×©××¢×œ×” ×”××©×ª××© 



× ×ª×•× ×™ ×”×§×œ×˜

×”×§×œ×˜ ××›×™×œ ×©× ×™ ×§×‘×¦×™ EXCEL: ×§×•×‘×¥ COURSES ×•×§×•×‘×¥ AVAILABILITY.

×§×•×‘×¥ COURSES: ××›×™×œ ××™×“×¢ ×¢×œ: ×©× ×”×§×•×¨×¡, ×©× ×”××¨×¦×”, ×”×¡××¡×˜×¨

×©×‘×• ××ª×§×™×™× ×”×§×•×¨×¡, ××©×š ×”×§×•×¨×¡ ×‘×©×¢×•×ª, ×”××¨×—×‘ ×‘×• ××ª×‘×¦×¢ ×”×§×•×¨×¡: ×›×™×ª×” ××• ×•×™×“××• (×–×•×), ×”×™×•×

×‘×©×‘×•×¢ ×‘×• ×—×™×™×‘ ×”×§×•×¨×¡ ×œ×”×ª×§×™×™× ×•×”×©×¢×” ×‘×™×•× ×‘×• ×—×™×™×‘ ×”×§×•×¨×¡ ×œ×”×ª×§×™×™×. ×× ×©×“×•×ª ×”××™×œ×•×¥

(×©×¢×”, ×™×•×) ×¨×™×§×™×, ××–×™ ××” ×©×™×§×‘×¢ ××ª ××•×¢×“ ×”×§×•×¨×¡ ×”×•× ××™×œ×•×¦×™ ×–××™× ×•×ª ×”××¨×¦×™× ×‘×œ×‘×“. 

×§×•×‘×¥ COURSES: ××©×š ×”×§×•×¨×¡ ××™×•×¦×’ ×‘×¢××•×“×” "×©×¢×•×ª" .

××“×•×‘×¨ ×¢×œ ××©×š ×¨×¦×™×£ ×•×œ× ×¢×œ ×©×¢×•×ª ××‘×•×–×¨×•×ª. 

×§×•×‘×¥ AVAILABILITY: ××›×™×œ ×¢××•×“×” TIMESTAMP ×©× ×™×ª×Ÿ ×œ×”×ª×¢×œ× ××× ×” ×•××™×Ÿ ×¦×•×¨×š ×œ×˜×¢×•×Ÿ ××•×ª×”.

×›××• ×›×Ÿ ××›×™×œ ×¢××•×“×•×ª ×©× ××¨×¦×”, ×•×¢××•×“×•×ª ×©×œ ×–××™× ×•×ª (×¡××¡×˜×¨ ×•×™×•×).

×§×•×‘×¥ AVAILABILITY: ×¢××•×“×•×ª ×–××™× ×•×ª:  ×©××•×ª ×”×¢××•×“×•×ª ×”× ×‘× ×™ ×©×ª×™ ×¡×¤×¨×•×ª (XY):  ×¡×¤×¨×” ×©×××œ×™×ª (X) = ×™×•× ×‘×©×‘×•×¢ (1-5). ×¡×¤×¨×” ×™×× ×™×ª (Y) = ×¡××¡×˜×¨ (×œ××©×œ 2).   ×“×•×’××”: ×¢××•×“×” 12 ××™×™×¦×’×ª ×–××™× ×•×ª ×‘×™×•× ×¨××©×•×Ÿ,

×¡××¡×˜×¨ 2.

×§×•×‘×¥ :  AVAILABILITY ×ª×•×›×Ÿ ×ª× ×›××• "16-17, 17-18"  ××•××¨ ×©×”××¨×¦×” ×¤× ×•×™ ××š ×•×¨×§ ×‘×©×¢×•×ª ××œ×•. ××¡×•×¨ ×œ×”× ×™×—

×¨×¦×£: ×× ×”×©×¢×” "12-13" ×œ× ×›×ª×•×‘×” ×‘××¤×•×¨×© ×‘×˜×§×¡×˜, ×”××¨×¦×” ×œ× ×™×›×•×œ ×œ×œ××“ ×‘×”, ×’×

×× ×™×© ×œ×• ×©×™×¢×•×¨ ×‘-11 ×•×‘-13.

×§×•×‘×¥ :  AVAILABILITY ×ª× ×¨×™×§ (NaN, None,

"") = ×™×•× ×—×¡×•× ×œ×—×œ×•×˜×™×Ÿ. ×¢××•×“×” ×—×¡×¨×” (×œ××©×œ, ×¢××•×“×” 52 ×œ× ×§×™×™××ª: ×”××©××¢×•×ª

×”×™× ×™×•× ×—×¡×•×. ×‘×¨×™×¨×ª ×”××—×“×œ ×©×œ ×›×œ ××¨×¦×” ×”×™× Unavailable.  ×¨×§

×©×¢×•×ª ×©×¦×•×™× ×• ×‘××¤×•×¨×© ×”×•×¤×›×•×ª ×œ-Available.



×“×¨×™×©×•×ª ×˜×›× ×™×•×ª

×”×©×ª××© ×‘-pandas.

×”×§×•×“ ×¦×¨×™×š ×œ×”×™×•×ª ××•×›×Ÿ ×œ×”×¨×¦×” (Copy-Paste)

×•×œ×§×‘×œ ×§×‘×¦×™× ×›×§×œ×˜.



×¢×§×¨×•× ×•×ª ×©×™×‘×•×¥

×–××™× ×•×ª ××‘×¡×•×œ×•×˜×™×ª (Strict Parsing):  :   ×‘×§×•×‘×¥ AVAILABILITY, ×ª×•×›×Ÿ

×ª× ×›××• "16-17, 17-18"  ××•××¨

×©×”××¨×¦×” ×¤× ×•×™ ××š ×•×¨×§ ×‘×©×¢×•×ª ××œ×•. ××¡×•×¨ ×œ×”× ×™×— ×¨×¦×£: ×× ×”×©×¢×” "12-13" ×œ×

×›×ª×•×‘×” ×‘××¤×•×¨×© ×‘×˜×§×¡×˜, ×”××¨×¦×” ×œ× ×™×›×•×œ ×œ×œ××“ ×‘×”, ×’× ×× ×™×© ×œ×• ×©×™×¢×•×¨ ×‘-11 ×•×‘-13.

×–××™× ×•×ª ××¨×¦×”: ××™×Ÿ ×œ×©×‘×¥ ××¨×¦×” ××—×•×¥ ×œ×©×¢×•×ª ×©×–×•×”×• ×‘- Strict

Parsing ×©×œ ×§×•×‘×¥

AVAILABILITY..

××™×Ÿ ×œ× ×—×© ×–××™× ×•×ª. ××¨×¦×” ×©×œ× ×©×œ×— ×§×•×‘×¥

×–××™× ×•×ª = ×œ× ××©×•×‘×¥.

××“×™× ×™×•×ª "×¨×©×™××” ×œ×‘× ×”" (Whitelist Availability): : ×‘×§×•×‘×¥

AVAILABILITY: ×ª× ×¨×™×§ (NaN, None, "") = ×™×•× ×—×¡×•× ×œ×—×œ×•×˜×™×Ÿ. ×¢××•×“×” ×—×¡×¨×” (×œ××©×œ, ×¢××•×“×” 52 ×œ× ×§×™×™××ª:

×”××©××¢×•×ª ×”×™× ×™×•× ×—×¡×•×. ×‘×¨×™×¨×ª ×”××—×“×œ ×©×œ ×›×œ ××¨×¦×” ×”×™×

Unavailable.  ×¨×§ ×©×¢×•×ª ×©×¦×•×™× ×• ×‘××¤×•×¨×© ×”×•×¤×›×•×ª ×œ-Available.

×—×¤×™×¤×ª ×¡×˜×•×“× ×˜×™×: ×œ×¡×˜×•×“× ×˜×™× ×‘××•×ª×• ×©× ×ª×•×Ÿ (×©× ×” ×', ×‘' ××•

×’') ×œ× ×™×›×•×œ×™× ×œ×”×™×•×ª ×©× ×™ ×©×™×¢×•×¨×™× ×‘××§×‘×™×œ ×›×œ×•××¨ ×‘××•×ª×• ×¦×™×¨×•×£ ×©×œ ×¡××¡×˜×¨ + ×™×•× + ×©×¢×”

(××œ× ×× ×”×§×•×¨×¡×™× ×©×™×™×›×™× ×œ××•×ª×” "×§×‘×•×¦×ª ×§×™×©×•×¨" ×©×¨×¦×” ×‘××§×‘×™×œ). 

×¨×¦×£: ×”×¢×“×¤×” ×œ×™×¦×™×¨×ª ×¨×¦×£ ×©×¢×•×ª ×œ××¨×¦×” (×œ×œ× ×—×•×¨×™×), ××š ×œ× ×¢×œ ×—×©×‘×•×Ÿ

××™×œ×•×¥ ×§×©×™×—. 



×˜×™×•×‘ × ×ª×•× ×™×

×œ××—×¨ ×§×¨×™××ª ×”×§×‘×¦×™× ×™×© ×œ×‘×¦×¢ ×˜×™×•×‘

×œ× ×ª×•× ×™×: 

× ×™×§×•×™ "×©××¨×™×•×ª" (Ghost Data):  ×•×“× ×©××™×Ÿ ×©×•×¨×•×ª × ×¡×ª×¨×•×ª ××• ×©×•×¨×•×ª

×–×‘×œ ×‘××£ ××—×“ ××§×‘×¦×™ ×”×§×œ×˜. ×× × ××¦××• × ×ª×•× ×™× ×›××œ×”, ×¡× ×Ÿ  ××•×ª×."

×¡× ×Ÿ ×©×•×¨×•×ª ×©×‘×”×Ÿ ×¢××•×“×ª '×©× ×§×•×¨×¡' ××• '×©×

××¨×¦×”' ×¨×™×§×”.

×”×¡×¨ ×¨×•×•×—×™× ××™×•×ª×¨×™× ××©××•×ª (Trim), ×˜×¤×œ

×‘×§×™×“×•×“ ×¢×‘×¨×™×ª.

× ×™×§×•×™ ×©××•×ª (Name

Normalization): ×. ×‘×¢×ª ×§×¨×™××ª

×©××•×ª (××¨×¦×™×, ×§×•×¨×¡×™×, ×©×¢×•×ª ×–××™× ×•×ª) ××§×‘×¦×™ COURSES ×•AVAILABILITY, ×¢×œ×™×š ×œ×‘×¦×¢ "× ×™×§×•×™ ××’×¨×¡×™×‘×™": ×‘×¦×¢ str().strip()  ×œ×”×¡×¨×ª ×¨×•×•×—×™× ×‘×”×ª×—×œ×” ×•×‘×¡×•×£. ×”×—×œ×£ ×¨×•×•×—×™× ×›×¤×•×œ×™×

×‘×¨×•×•×— ×™×—×™×“ (×œ××©×œ: "×™×©×¨××œ ×™×©×¨××œ×™" -> "×™×©×¨××œ ×™×©×¨××œ×™"). 

×”×”×©×•×•××” ×‘×™×Ÿ ×©× ××¨×¦×” ×‘×§×•×‘×¥ ×”×§×•×¨×¡×™× ×œ×©×

×‘×§×•×‘×¥ ×”×–××™× ×•×ª ×—×™×™×‘×ª ×œ×”×ª×‘×¦×¢ ×¢×œ ×‘×¡×™×¡ ×”××—×¨×•×–×•×ª ×”×× ×•×§×•×ª.



× ×¨××•×œ × ×ª×•× ×™×

× ×¨××œ ××ª ×›×œ ×”× ×ª×•× ×™× ×‘×§×•×‘×¥ COURSES  ×œ×¤×™ ×”××¤×ª×—: 1 = ×™×•× ×¨××©×•×Ÿ, 2 = ×™×•× ×©× ×™,

3 = ×™×•× ×©×œ×™×©×™, 4 = ×™×•× ×¨×‘×™×¢×™, 5 = ×™×•× ×—××™×©×™.

"× ×¨××•×œ ×©××•×ª ×¢××•×“×•×ª": ×”××¨×ª

"×©×¢×•×ª" ×œ-Hours

×•"××¨×—×‘" ×œ-Space.

×‘×§×•×‘×¥ COURSES.



×•×œ×™×“×¦×™×”

×‘×“×™×§×ª ×©×¤×™×•×ª(Sanity Check): ×œ×¤× ×™

×ª×—×™×œ×ª ×”×©×™×‘×•×¥, ×¢×œ×™×š ×œ×”×“×¤×™×¡ ×œ××¡×š "×“×•×’××™×ª ×‘×“×™×§×”" ×©×œ 3 ××¨×¦×™× ××§×¨××™×™×: ×”×¦×’

××ª ×”×˜×§×¡×˜ ×”××§×•×¨×™ ××”×§×•×‘×¥ AVAILABILITY ××•×œ ×¨×©×™××ª ×”×©×¢×•×ª ×©×”×§×•×“ ×©×œ×š

"×”×‘×™×Ÿ", ×›×“×™ ×œ×•×•×“× ×©××™×Ÿ ×˜×¢×•×™×•×ª ×§×¨×™××”.

×—×•×§ ×”"×—×™×ª×•×š ×‘×œ×‘×“ (Strict Intersection): ×¦×•×¨

×¨×©×™××” (Set) ×©×œ ×›×œ ×”××¨×¦×™× ×”××•×¤×™×¢×™× ×‘×§×•×‘×¥

AVAILABILITY. . ×¢×‘×•×¨ ×¢×œ × ×ª×•× ×™

×”×§×•×¨×¡×™×.  ×™×©

×œ××—×•×§ ××”DataFrame

×›×œ ×©×•×¨×” ×‘× ×ª×•× ×™ ×”×§×•×¨×¡×™× ×©×‘×” ×©× ×”××¨×¦×” ××™× ×• ××•×¤×™×¢ ×‘××“×•×™×§ ×‘×¨×©×™××ª ×”××¨×¦×™× ×”×–××™× ×™×

(××ª×•×š AVAILABILITY). .  ×¤×œ×˜: ×”×“×¤×¡

×œ××¡×š: "Removed X courses due to missing

lecturer availability: [List of Names]".

×”×ª× ×’×©×•×™×•×ª ×¤×™×–×™×§×œ×™×•×ª (Impossible Constraints): ×× ×œ××¨×¦×” ×™×© ×©× ×™ ×§×•×¨×¡×™× ××• ×™×•×ª×¨ ×”××•×’×“×¨×™× ×¢× ××•×ª×• ××™×œ×•×¥ ×™×•×

×•×©×¢×” ×•×¡××¡×˜×¨ (×œ××©×œ: ×©× ×™×”× ×‘×¡××¡×˜×¨ 1 ×‘×™×•× 1 ×©×¢×” 8:00) â€“ ×–×•×”×™ ×”×ª× ×’×©×•×ª ×¤×™×–×™×§×œ×™×ª.

×”×¤×¢×•×œ×” ×”× ×“×¨×©×ª : ×”×›× ×¡ ××ª ×”×§×•×¨×¡×™× ×œ×§×•×‘×¥ ×”×©×’×•×™×™×. ××‘× ×” ×ª×™××•×¨ ×”×©×’×™××”: "×‘×¡××¡×˜×¨ X ×‘×™×•× Y ×‘×©×¢×” Z, ××¨×¦×” A ×œ× ×™×›×•×œ ×œ×œ××“ ×’× ××ª

×§×•×¨×¡ B ×•×’×

××ª ×§×•×¨×¡ C" 

×‘×“×™×§×ª ×™×™×—×•×“×™×•×ª ××—××™×¨×” (Strict Uniqueness Integrity) ::  ×™×©

×œ×‘×¦×¢ ×•×•×œ×™×“×¦×™×” ×œ×× ×™×¢×ª ×›×¤×™×œ×•×™×•×ª ×©××•×ª ×©×™×•×‘×™×œ×• ×œ×“×¨×™×¡×ª × ×ª×•× ×™×:×”×’×“×¨ ××¤×ª×— ×™×™×—×•×“×™ (unique key)

×”××•×¨×›×‘ ××”×©×™×œ×•×‘: ×©× ×”+×¡××¡×˜×¨+×©× ×§×•×¨×¡.  ×–×™×”×•×™

×›×¤×™×œ×•×™×•×ª: ×¡×¨×•×§ ××ª ×¨×©×™××ª ×”×§×•×¨×¡×™×. ×× ×§×™×™××•×ª ×©×ª×™ ×©×•×¨×•×ª ××• ×™×•×ª×¨ ×‘×¢×œ×•×ª ××•×ª×• ××¤×ª×—

×™×™×—×•×“×™ ×‘×“×™×•×§,  ×–×”×• ××¦×‘ CRITICAL FAIL. ×¤×¢×•×œ×”

× ×“×¨×©×ª ×‘××§×¨×” ×–×”: ×¢×¦×•×¨ ××™×™×“×™×ª (Abort Execution): ××œ ×ª× ×¡×” ×œ×©×‘×¥, ××œ ×ª× ×—×©, ×•××œ ×ª×©× ×” ×©××•×ª

××•×˜×•××˜×™.  ×“×•×— ×©×’×™××•×ª ××¤×•×¨×˜: ×”×“×¤×¡ ×œ××¡×š

×˜×‘×œ×” ×‘×¨×•×¨×” ×©×œ ×”×›×¤×™×œ×•×™×•×ª ×©× ××¦××•, ×‘×¤×•×¨××˜: "×©×’×™××”: ×”×§×•×¨×¡ [×©×] ×‘×©× ×” [X] ×¡××¡×˜×¨ [Y] ××•×¤×™×¢ [N] ×¤×¢××™×. ×™×© ×œ×ª×ª ×©××•×ª ×™×™×—×•×“×™×™× (×œ××©×œ:

'×§×‘×•×¦×” ×', '×§×‘×•×¦×” ×‘') ×‘×§×•×‘×¥ ×”××§×•×¨.""



×§×“× ×©×™×‘×•×¥ 

××™×•×Ÿ ×œ×§×‘×•×¦×•×ª: ×§×‘×¥ ×§×•×¨×¡×™× ×¢× Link ID ×œ-Link_Groups.××ª ×©××¨ ×”×§×•×¨×¡×™× ×¡×•×•×’ ×›-Single_Courses. .

×œ×¤× ×™ ×ª×—×™×œ×ª ×”×©×™×‘×•×¥, ×¢×‘×•×¨ ×¢×œ ×›×œ ××¨×¦×” ×‘× ×ª×•× ×™

×”×–××™× ×•×ª ×•×—×©×‘ ×œ×• Sparsity_Score::  ×¡×›×•× ××ª ×¡×š ×›×œ ×”×©×¢×•×ª ×”×¤× ×•×™×•×ª (Total

Slots) ×©×™×© ×œ××¨×¦×” ×‘×›×œ ×”×©×‘×•×¢.    ××¨×¦×” ×¢× ××¢×˜ ×©×¢×•×ª ×¤× ×•×™×•×ª ×™×§×‘×œ ×¦×™×•×Ÿ × ××•×š

(Critical Resource)..  ××¨×¦×” ×¢× ×”××•×Ÿ ×©×¢×•×ª ×¤× ×•×™×•×ª ×™×§×‘×œ ×¦×™×•×Ÿ ×’×‘×•×”

(Flexible Resource).

××“×“ ×–×” ×™×©××© ×œ×§×‘×™×¢×ª ×¡×“×¨ ×”×©×™×‘×•×¥ ×‘×©×œ×‘ ×”×‘×."

 



×©×™×‘×•×¥

×¢×“×™×¤×•×ª 0: ××™×œ×•×¦×™× ×§×©×™×—×™× (Hard Constraints):: ×× ×‘×§×•×‘×¥ COURSES××•×’×“×¨ ××™×œ×•×¥ ×™×•× ××• ××™×œ×•×¥ ×©×¢×”, ×—×•×‘×”

×œ×›×‘×“ ××•×ª×.

×¢×“×™×¤×•×ª 1: ×§×‘×•×¦×•×ª ×§×™×©×•×¨ (Atomic Groups),×§×•×¨×¡×™× ×‘×¢×œ×™ ××•×ª×• ××–×”×” ×‘×©×“×” ×§×™×©×•×¨ (Link ID) . ×”×›×œ×œ: ×§×•×¨×¡×™× ××œ×•

×—×™×™×‘×™× ×œ×”×©×ª×‘×¥ ×‘××•×ª×• ×¡××¡×˜×¨, ×‘××•×ª×• ×™×•× ×•×‘××•×ª×” ×©×¢×ª ×”×ª×—×œ×” ×‘×“×™×•×§. ×œ×•×’×™×§×ª ×—×™×ª×•×š: ×—×©×‘

××ª "×—×™×ª×•×š ×”×–×× ×™×" (Intersection) ×©×œ ×›×œ ×”××¨×¦×™× ×‘×§×‘×•×¦×”. ×× ×”×—×™×ª×•×š ×¨×™×§

(××™×Ÿ ×©×¢×” ××©×•×ª×¤×ª ×œ×›×•×œ×) â€“ ××œ ×ª×©×‘×¥ ××£ ××—×“ ××”×, ×•×“×•×•×— ×¢×œ ×©×’×™××”: "Link Conflict".

×¢×“×™×¤×•×ª 2: ××™×œ×•×¦×™× ×¨×›×™× (Soft Constraints): : ×. ×–×•×: ×©×™×¢×•×¨×™ ×–×•× ×™×©×•×‘×¦×• ×¢×“×™×¤×•×ª ×›×©×™×¢×•×¨

××—×¨×•×Ÿ ×‘×™×•×. :Zoom Logic:  ××

××–×•×”×” "×–×•×" ×‘×¢××•×“×ª "××¨×—×‘" ×‘×§×•×‘×¥

COURSES, ×”××œ×’×•×¨×™×ª× ×¡×•×¨×§ ××ª ×”×©×¢×•×ª ××”×¡×•×£ ×œ×”×ª×—×œ×”

(19:00 -> 08:00) ×›×“×™ ×œ× ×¡×•×ª ×œ×“×—×•×£ ××ª ×”×©×™×¢×•×¨ ×œ×¡×•×£ ×”×™×•×. ×‘. ×¨×¦×£: ×”×¢×“×¤×” ×œ×™×¦×™×¨×ª

×¨×¦×£ ×©×¢×•×ª ×œ××¨×¦×” (×œ×œ× ×—×•×¨×™×), ××š ×œ× ×¢×œ ×—×©×‘×•×Ÿ ××™×œ×•×¥ ×§×©×™×—.

×”×©×™×‘×•×¥ ×™×ª×‘×¦×¢ ×‘××¡×¤×¨ ×’×œ×™×, ×›××©×¨ ××¡×•×¨

×œ×“×¨×•×¡ ×©×™×‘×•×¥ ×§×™×™×:

×’×œ ×: ×§×•×¨×¡×™× ×©×™×© ×‘×”× ×’× ××™×œ×•×¥ ×§×©×•×— (FixDay ××• FixHour.)

×•×’× ×§×‘×•×¦×ª ×§×™×©×•×¨ (×§×•×¨×¡×™× ×¢× LinkID)). )

 ×’×œ ×‘: ×§×•×¨×¡×™× ×©×™×© ×œ×”× ××™×œ×•×¥ ×§×©×•×— (FixDay ××• FixHour.)

×œ×œ× ×§×‘×•×¦×ª ×§×™×©×•×¨ (LinkID)

×’×œ ×’: ×§×•×¨×¡×™× ×©×™×© ×œ×”× ×§×‘×•×¦×ª ×§×™×©×•×¨ (LinkID)

×œ×œ× ××™×œ×•×¥ ×§×©×•×—

×’×œ ×“: ×§×•×¨×¡×™× ×©×œ ××¨×¦×™× ×‘×¢×œ×™ ×”×¦×™×•×Ÿ ×”× ××•×š ×‘×™×•×ª×¨ ×‘××“×“ ×’××™×©×•×ª ×”××¨×¦×” (Sparsity Score - Ascending): (×”×›×™

×¤×—×•×ª ×©×¢×•×ª ×¤× ×•×™×•×ª) . 

×’×œ

×”: ××©×š ×”×§×•×¨×¡ (Duration - Descending): ×§×•×¨×¡×™× ××¨×•×›×™× ×™×•×ª×¨ ×™×©×•×‘×¦×• ×œ×¤× ×™ ×§×¦×¨×™×."   Block Scheduling .

×¤×•× ×§×¦×™×”

_is_block_valid ×ª×‘×“×•×§ ×¨×¦×£ ×©×œ N   ×©×¢×•×ª ×¤× ×•×™×•×ª (×œ××¨×¦×” ×•×œ×¡×˜×•×“× ×˜×™×). (×œ×¤×™

×”×“×¨×™×©×” ×‘× ×ª×•× ×™ ×”×§×•×¨×¡×™×. 

×œ×•×’×™×§×ª ×”×©×™×‘×•×¥: ×¢×‘×•×¨ ×›×œ ×§×•×¨×¡ ×‘×›×œ ×’×œ: ×—×¤×© ××ª ×”××©×‘×¦×ª ×”×¨××©×•× ×” ×©×‘×” ×”××¨×¦×” ×¤× ×•×™

×•×”×¡×˜×•×“× ×˜×™× ×¤× ×•×™×™×. ×× ××•×’×“×¨ "Zoom" ×‘××¨×—×‘ - ×¡×¨×•×§ ××”×¡×•×£ ×œ×”×ª×—×œ×”. ××—×¨×ª,

××”×”×ª×—×œ×” ×œ×¡×•×£.



×‘×“×™×§×ª ×”×©×™×‘×•×¥

×•×•×œ×™×“×¦×™×”

(Validation): ×œ××—×¨ ×™×¦×™×¨×ª ×”×˜×‘×œ×”

×”×¡×•×¤×™×ª, ×¢×‘×•×¨ ×©×•×¨×”-×©×•×¨×” ×•×‘×“×•×§ ××ª ×”×©×™×‘×•×¥ ××•×œ ×”×˜×§×¡×˜ ×”×’×•×œ××™ ×”××§×•×¨×™ ×‘×§×•×‘×¥ ×”×–××™× ×•×ª.

×× ×™×© ××™-×”×ª×××”, ×”×¡×¨ ××”××¢×¨×›×ª ×•×”×¢×‘×¨ ×œ×“×•×— ×©×’×™××•×ª.

×‘×“×•×§ ×©×‘×˜×‘×œ××•×ª ×”×¡×•×¤×™×•×ª (××¢×¨×›×ª, ×§×•×‘×¥

×©×’×•×™×™×) ×›×œ ×©××•×ª ×”××¨×¦×™× ×§×™×™××™× ×‘× ×ª×•× ×™ ×”×§×•×¨×¡×™× ×•×’× ×‘× ×ª×•× ×™ ×”×–××™× ×•×ª. ×× × ××¦× ×‘×˜×‘×œ××•×ª

×”×¡×•×¤×™×•×ª ×©× ×§×•×¨×¡ ××• ×©× ××¨×¦×” ×©××™× ×• ×§×™×™× ×‘× ×ª×•× ×™ ×”×§×œ×˜, ×™×© ×œ×ª×ª ×”×•×“×¢×” ××ª××™××” ×•×œ×”×ª×—×™×œ

××ª ×”×©×™×‘×•×¥ ××—×“×©. 

×× × ×•×ª×¨ ×§×•×¨×¡ ×‘×•×“×“ (single) ××—×“ ××• ×™×•×ª×¨ ×œ×œ×

×©×™×‘×•×¥, ×‘×¦×¢ ××—×“×© ××ª ×’×œ×™× ×“,×” ×©×œ ×ª×”×œ×™×š ×”×©×™×‘×•×¥ (×”×©××¨ ×œ×œ× ×©×™× ×•×™ ××ª ×”×©×™×‘×•×¦×™× ×©×œ ×’×œ×™×

×, ×‘), ×”×¤×¢× ×œ×¤×™ ×¡×“×¨ ×”×¢×“×™×¤×•×™×•×ª ×”×‘× ××”×—×©×•×‘ ×œ×¤×—×•×ª ×—×©×•×‘::  1. ××©×š ×”×§×•×¨×¡

(Duration - Descending): ×§×•×¨×¡×™×

××¨×•×›×™× ×™×•×ª×¨ ×™×©×•×‘×¦×• ×œ×¤× ×™ ×§×¦×¨×™× (×¤×•× ×§×¦×™×”

_is_block_valid ×ª×‘×“×•×§ ×¨×¦×£ ×©×œ N   ×©×¢×•×ª ×¤× ×•×™×•×ª (×œ××¨×¦×” ×•×œ×¡×˜×•×“× ×˜×™×). (×œ×¤×™ ×”×“×¨×™×©×” ×‘× ×ª×•× ×™ ×”×§×•×¨×¡×™×.)." 2.

××“×“ ×’××™×©×•×ª ×”××¨×¦×” (Sparsity Score -

Ascending): ×§×•×¨×¡×™× ×©×œ ××¨×¦×™× ×‘×¢×œ×™

×”×¦×™×•×Ÿ ×”× ××•×š ×‘×™×•×ª×¨ (×”×›×™ ×¤×—×•×ª ×©×¢×•×ª ×¤× ×•×™×•×ª) ×™×©×•×‘×¦×• ×§×•×“×. 



×¤×œ×˜

Final_Schedule.csv:

×˜×‘×œ×” ×¡×•×¤×™×ª (Year, Day, Hour, Course, Lecturer). 

Unscheduled_Report.csv:

×˜×‘×œ×” ×§×¨×™×˜×™×ª ×œ×“×™×‘×•×’. ×œ×›×œ ×§×•×¨×¡ ×©×œ× ×©×•×‘×¥, ×¦×™×™×Ÿ ××ª ×”×¡×™×‘×” ×”××“×•×™×§×ª: "Lecturer Missing from Availability"

(××—×¨×™ ×©× ×™×¡×™×ª ×œ× ×¨××œ ×©××•×ª ×•×¢×“×™×™×Ÿ ×œ× ××¦××ª). "Lecturer

Double Booked". "Group Conflict - No Intersection".

"Student Cohort Busy".







×”×¡×§×¨×™×¤×˜

 



import pandas as pd

import numpy as np

import os

import io



# ================= CONFIGURATION =================

# ×©××•×ª ×”×§×‘×¦×™× ×›×¤×™ ×©×”× ××•×¤×™×¢×™× ××¦×œ×š

COURSES_FILE = 'COURSES.xlsx - ×’×™×œ×™×•×Ÿ1.csv'

AVAILABILITY_FILE = 'AVAILABILITY.xlsx - Form responses 1.csv'



# ××™×¤×•×™ ×©××•×ª ×™×“× ×™ ×œ×˜×™×¤×•×œ ×‘××™-×”×ª×××•×ª (×§×•×¨×¡×™× -> ×–××™× ×•×ª)

NAME_MAPPING = {

    '××™×›×œ ×¨×•×¤×': '××™×›×œ ×¨×•×¤× ×ª×›× ×•×Ÿ ××§×œ×™××™',

    '× ×¢××” ×¦×™×–×¨ ×©×‘×ª××™': '× ×¢××” ×©×‘×ª××™-×¦×™×–×¨',

    '××•×¨× ×” ×’×¨×•×¤×™× ×§×œ ×§×•×œ××Ÿ': '××•×¨× ×” ×’×•×¨×¤×™× ×§×œ ×§×•×œ××Ÿ', # ×œ××§×¨×” ×©×œ ×¨×•×•×—×™× × ×¡×ª×¨×™×

    '××ª×¨×’×œ': '× ×•×¢×” ×’×™× ×•' # ×”× ×—×” ××•×¤×¦×™×•× ×œ×™×ª - × ×™×ª×Ÿ ×œ×”×¡×™×¨ ×× ×œ× ×¨×•×¦×™×

}



# ××™×¤×•×™ ×¢××•×“×•×ª ×–××™× ×•×ª ×œ×™××™×

AVAIL_COLS_MAP = {'12': 1, '22': 2, '32': 3, '42': 4, '52': 5}

HOURS_RANGE = range(8, 22)  # ×˜×•×•×— ×©×¢×•×ª ×‘×“×™×§×” (08:00 ×¢×“ 21:00)



# ================= 1. DATA CLEANING UTILS =================

def clean_text(text):

   

    if pd.isna(text) or str(text).strip() == "":

        return None

    text = str(text).strip()

    return " ".join(text.split())



def parse_availability_string(avail_str):

   

    slots = set()

    if pd.isna(avail_str):

        return slots

    

    # ×”×—×œ×¤×ª ××¤×¨×™×“×™× ×©×•× ×™× ×‘×¤×¡×™×§

    parts = str(avail_str).replace(';', ',').split(',')

    

    for part in parts:

        part = part.strip()

        if '-' in part:

            try:

                # ×¤×•×¨××˜ 16-17 ××•××¨ ×©×©×¢×” 16 ×¤× ×•×™×”

                start, end = map(int, part.split('-'))

                for h in range(start, end):

                    slots.add(h)

            except ValueError:

                continue

    return slots



# ================= 2. LOADING & PRE-PROCESSING =================

def load_and_clean_data():

    print(">>> ×˜×•×¢×Ÿ × ×ª×•× ×™×...")

    

    # × ×™×¡×™×•×Ÿ ×˜×¢×™× ×” ×¢× ×§×™×“×•×“×™× ×©×•× ×™× ×œ×¢×‘×¨×™×ª

    try:

        df_courses = pd.read_csv(COURSES_FILE, encoding='utf-8')

        df_avail = pd.read_csv(AVAILABILITY_FILE, encoding='utf-8')

    except (UnicodeDecodeError, FileNotFoundError):

        try:

            df_courses = pd.read_csv(COURSES_FILE, encoding='cp1255')

            df_avail = pd.read_csv(AVAILABILITY_FILE, encoding='cp1255')

        except FileNotFoundError:

            print("CRITICAL ERROR: ×§×‘×¦×™ ×”×§×œ×˜ ×œ× × ××¦××•. ×•×“× ×©×”×¢×œ×™×ª ××ª ×”×§×‘×¦×™×.")

            return None, None, None



    # × ×¨××•×œ ×©××•×ª ×¢××•×“×•×ª (×”×¡×¨×ª ×¨×•×•×—×™× ××”×›×•×ª×¨×•×ª)

    df_courses.columns = df_courses.columns.str.strip()

    df_avail.columns = df_avail.columns.str.strip()



    # × ×¨××•×œ ×˜×§×¡×˜ ×‘×ª×•×›×Ÿ

    text_cols_courses = ['×©× ×§×•×¨×¡', '××¨×¦×”', '×§×™×©×•×¨', '××¨×—×‘']

    for col in text_cols_courses:

        if col in df_courses.columns:

            df"""

def configure_gemini():
    if "GOOGLE_API_KEY" not in st.secrets:
        st.error("×—×¡×¨ ××¤×ª×— GOOGLE_API_KEY ×‘×§×•×‘×¥ ×”×¡×•×“×•×ª.")
        return None
    
    genai.configure(api_key=st.secrets["GOOGLE_API_KEY"])
    
    # ×”×’×“×¨×•×ª ×‘×˜×™×—×•×ª (×›×“×™ ×œ×× ×•×¢ ×—×¡×™××ª ×ª×©×•×‘×•×ª ×©×•×•×)
    safety_settings = [
        {"category": "HARM_CATEGORY_HARASSMENT", "threshold": "BLOCK_NONE"},
        {"category": "HARM_CATEGORY_HATE_SPEECH", "threshold": "BLOCK_NONE"},
        {"category": "HARM_CATEGORY_SEXUALLY_EXPLICIT", "threshold": "BLOCK_NONE"},
        {"category": "HARM_CATEGORY_DANGEROUS_CONTENT", "threshold": "BLOCK_NONE"},
    ]
    
    model = genai.GenerativeModel(
        model_name="gemini-1.5-flash",
        system_instruction=LOOZ_INSTRUCTIONS,
        safety_settings=safety_settings
    )
    return model

# --- ×××©×§ ×”××©×ª××© ---
st.title("ğŸ“ ××¢×¨×›×ª × ×™×”×•×œ ××¢×¨×›×ª ×©×¢×•×ª")

# ××ª×—×•×œ ×–×™×›×¨×•×Ÿ ×”×©×™×—×” ×× ×œ× ×§×™×™×
if "messages" not in st.session_state:
    st.session_state.messages = []

action = st.radio(
    "×‘×—×¨ ×¤×¢×•×œ×”:",
    ["×‘× ×” ×œ×™ ××¢×¨×›×ª (LOOZ)", "×‘× ×” ×œ×™ ×©××œ×•×Ÿ"],
    horizontal=True
)

st.markdown("---")

# === ×œ×•×’×™×§×” ×©×œ LOOZ (×¦'××˜) ===
if action == "×‘× ×” ×œ×™ ××¢×¨×›×ª (LOOZ)":
    st.header("ğŸ¤– ×”×‘×•×˜ LOOZ - ×‘× ×™×™×ª ××¢×¨×›×ª")
    
    # ×©×œ×‘ 1: ×”×¢×œ××ª ×§×‘×¦×™× (××•×¦×’ ×¨×§ ×× ×¢×•×“ ×œ× ×”×ª×—×œ× ×• ×©×™×—×” ××• ×©×¨×•×¦×™× ×œ×”×ª×—×™×œ ××—×“×©)
    with st.expander("ğŸ“‚ ×˜×¢×™× ×ª ×§×‘×¦×™× ×•×”×’×“×¨×•×ª", expanded=(len(st.session_state.messages) == 0)):
        uploaded_files = st.file_uploader(
            "×§×‘×¦×™ ×§×œ×˜ (PDF, Excel, ×ª××•× ×•×ª)", 
            accept_multiple_files=True,
            type=['pdf', 'csv', 'txt', 'png', 'jpg', 'xlsx']
        )
        user_notes = st.text_area("×”×¢×¨×•×ª ×¨××©×•× ×™×•×ª:", "×‘× ×” ×œ×™ ××¢×¨×›×ª ×©×¢×•×ª ×‘×”×ª×‘×¡×¡ ×¢×œ ×”×§×‘×¦×™×.")
        
        start_btn = st.button("×”×ª×—×œ ×¢×™×‘×•×“ ×•×‘× ×™×™×ª ××¢×¨×›×ª ğŸš€", type="primary")

    # ×©×œ×‘ 2: ××ª×—×•×œ ×”×©×™×—×” ×‘×¢×ª ×œ×—×™×¦×”
    if start_btn and uploaded_files:
        model = configure_gemini()
        if model:
            # ×”×›× ×ª ×”×”×•×“×¢×” ×”×¨××©×•× ×” (×˜×§×¡×˜ + ×§×‘×¦×™×)
            content_parts = [user_notes]
            for file in uploaded_files:
                content_parts.append({
                    "mime_type": file.type,
                    "data": file.getvalue()
                })
            
            # ×©××™×¨×ª ×”×”×•×“×¢×” ×”×¨××©×•× ×” ×©×œ ×”××©×ª××© ×‘×–×™×›×¨×•×Ÿ
            st.session_state.messages = [
                {"role": "user", "parts": content_parts, "display_text": user_notes} 
                # display_text × ×•×¢×“ ×œ×”×¦×™×’ ×œ××©×ª××© ×¨×§ ××ª ×”×˜×§×¡×˜ ×‘×œ×™ ×”"×‘×œ×’×Ÿ" ×©×œ ×”×§×‘×¦×™×
            ]
            
            # ×§×‘×œ×ª ×ª×©×•×‘×” ×¨××©×•× ×” ××”×‘×•×˜
            with st.spinner("LOOZ ×× ×ª×— ××ª ×”×§×‘×¦×™× ×•×‘×•× ×” ××ª ×”××¢×¨×›×ª... (×–×” ×¢×©×•×™ ×œ×§×—×ª ×¨×’×¢)"):
                try:
                    response = model.generate_content(content_parts)
                    st.session_state.messages.append({"role": "model", "parts": [response.text]})
                except Exception as e:
                    st.error(f"×©×’×™××”: {str(e)}")

    # ×©×œ×‘ 3: ×”×¦×’×ª ×”×™×¡×˜×•×¨×™×™×ª ×”×¦'××˜
    for msg in st.session_state.messages:
        role = "user" if msg["role"] == "user" else "assistant"
        with st.chat_message(role):
            # ×× ×–×• ×”×•×“×¢×ª ××©×ª××© ×¢× ×§×‘×¦×™×, × ×¦×™×’ ×¨×§ ××ª ×”×˜×§×¡×˜
            if "display_text" in msg:
                st.write(msg["display_text"])
                if role == "user": 
                    st.caption("ğŸ“ (×§×‘×¦×™× ××¦×•×¨×¤×™×)")
            else:
                # ×”×•×“×¢×” ×¨×’×™×œ×”
                st.write(msg["parts"][0])

    # ×©×œ×‘ 4: ×ª×™×‘×ª ×¦'××˜ ×œ×”××©×š ×©×™×—×”
    if prompt := st.chat_input("×›×ª×•×‘ ×ª×’×•×‘×” ×œ-LOOZ... (×œ××©×œ: '×©× ×” ××ª ×™×•× ×©×œ×™×©×™')"):
        if not st.session_state.messages:
            st.warning("×™×© ×œ×˜×¢×•×Ÿ ×§×‘×¦×™× ×•×œ×”×ª×—×™×œ ××ª ×”×©×™×—×” ×§×•×“×.")
        else:
            # ×”×•×¡×¤×ª ×”×•×“×¢×ª ×”××©×ª××© ×”×—×“×©×” ×œ×–×™×›×¨×•×Ÿ
            st.session_state.messages.append({"role": "user", "parts": [prompt]})
            with st.chat_message("user"):
                st.write(prompt)

            # ×©×œ×™×—×ª ×›×œ ×”×”×™×¡×˜×•×¨×™×” ×œ×’'××™× ×™ (×›×“×™ ×©×™×–×›×•×¨ ××ª ×”×§×‘×¦×™× ××”×”×ª×—×œ×”)
            model = configure_gemini()
            if model:
                history_for_gemini = []
                for msg in st.session_state.messages:
                    history_for_gemini.append({
                        "role": msg["role"],
                        "parts": msg["parts"]
                    })
                
                with st.chat_message("assistant"):
                    with st.spinner("×—×•×©×‘..."):
                        try:
                            response = model.generate_content(history_for_gemini)
                            st.write(response.text)
                            # ×©××™×¨×ª ×”×ª×©×•×‘×” ×‘×–×™×›×¨×•×Ÿ
                            st.session_state.messages.append({"role": "model", "parts": [response.text]})
                        except Exception as e:
                            st.error(f"×©×’×™××”: {e}")

# === ×œ×•×’×™×§×” ×©×œ ×©××œ×•× ×™× ===
elif action == "×‘× ×” ×œ×™ ×©××œ×•×Ÿ":
    # × ×™×§×•×™ ×”×¦'××˜ ×× ×¢×•×‘×¨×™× ××¡×š, ×›×“×™ ×©×œ× ×™×¤×¨×™×¢
    if "messages" in st.session_state and st.session_state.messages:
        if st.button("× ×§×” ×”×™×¡×˜×•×¨×™×™×ª ×¦'××˜"):
            st.session_state.messages = []
            st.rerun()
            
    quest.run()